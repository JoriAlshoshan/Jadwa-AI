{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block content %}
<div class="page">
  <section class="legal-page">
    <div class="legal-container" style="max-width:420px; margin:0 auto;">

      <div style="text-align:center; margin-bottom:34px;">
        <h2 style="margin-bottom:12px; color:#0b0f1a;">
          {% trans "Login to Jadwa AI" %}
        </h2>

        <p style="margin-bottom:30px; color:#64748b;">
          {% trans "Access your dashboard and start your feasibility analysis." %}
        </p>
      </div>

      {% if messages %}
        {% for message in messages %}
          <div class="inline-msg inline-msg--error">{{ message }}</div>
        {% endfor %}
      {% endif %}

      <form method="post" class="contact-form" novalidate>
        {% csrf_token %}

        {% if form.non_field_errors %}
          <div class="form-error" style="display:block; margin-bottom:10px;">
            {{ form.non_field_errors|striptags }}
          </div>
        {% endif %}

        {% for field in form %}
          <div class="form-row {% if field.errors %}is-error{% endif %}">
            <label class="form-label" for="{{ field.id_for_label }}">{{ field.label }}</label>

            {{ field }}

            {% if field.errors %}
              <div class="form-error">{{ field.errors.0 }}</div>
            {% endif %}
          </div>
        {% endfor %}

        <button type="submit" class="btn btn-full" style="margin-top:12px;">
          {% trans "Login" %}
        </button>
      </form>

      <div class="auth-links-clean">
        <p>
          {% trans "Forgot your password?" %}
          <a href="{% url 'forgot_password' %}" class="auth-link-clean">
            {% trans "Reset it" %}
          </a>
        </p>

        <p>
          {% trans "Don't have an account?" %}
          <a href="{% url 'signup' %}" class="auth-link-clean">
            {% trans "Create one" %}
          </a>
        </p>
      </div>

    </div>
  </section>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {

  function clearError(field){
    const row = field.closest(".form-row");
    if(!row) return;

    // لو فيه قيمة بالحقل، شيل الخطأ
    if ((field.value || "").trim() !== "") {
      row.classList.remove("is-error");
      const error = row.querySelector(".form-error");
      if(error){
        error.remove(); // الأفضل: نحذفه بدل نخفيه
      }
    }
  }

  // نراقب فقط حقول الفورم اللي داخل .form-row
  document.querySelectorAll(".form-row input, .form-row textarea, .form-row select")
    .forEach(function(field){

      // أول ما تكتبين/تلصقين/تغيرين
      ["input","keyup","change"].forEach(evt => {
        field.addEventListener(evt, function(){ clearError(field); });
      });

      field.addEventListener("paste", function(){
        setTimeout(() => clearError(field), 0);
      });

      // لو صار autofill من المتصفح
      setTimeout(() => clearError(field), 200);
    });

});
</script>
{% endblock %}
